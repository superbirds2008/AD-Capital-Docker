version: '3'

volumes:
  project:
    external: true
  appdynamics:
    external: true
  grafana_data:
    external: true

services:
  networkvizagent:
    # image: path/to/your/docker/image # docker registry image
    container_name: networkvizagent 
    network_mode: "host"
    build:
      context: ADCapital-NetworkAgent
      args:
       NETVIZ_ZIP_PKG: appd-netviz-x64-linux-21.3.0.2181.zip
    restart: unless-stopped 
    volumes:
      - project:/project
      - appdynamics:/appdynamics
    ports:
      - "3892:3892"
    env_file: ./docker-compose.env
    cap_add:
      - NET_ADMIN
      - NET_RAW
    extra_hosts:
      - "appdserver.demo.io:10.124.52.26"

  rest:
    container_name: rest
    hostname: rest
    build:
      context: ./ADCapital-Tomcat
    image: appdynamics/adcapital-tomcat
    volumes:
    - project:/project
    - appdynamics:/appdynamics
    logging:
      driver: "none"
    env_file: ./docker-compose.env
    environment:
    - "ROLE=rest"
    - "APPDYNAMICS_AGENT_NODE_NAME=Rest"
    - "APPDYNAMICS_AGENT_TIER_NAME=Authentication-Service"
    ports:
    - "8081:8080"
    extra_hosts:
      - "appdserver.demo.io:10.124.52.26"
    restart:
      always
